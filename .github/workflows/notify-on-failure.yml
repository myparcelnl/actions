name: 'Send Slack webhook on failed job'

on:
  workflow_call:

jobs:
  notify-on-failure:
    runs-on: ubuntu-22.04
    steps:
      # if debug mode is enabled, don't send the notification
      - if: runner.debug == 'true'
        #language=bash
        run: |
          echo "Debug mode enabled, skipping slack notification"
          exit 0

      - uses: actions/checkout@v4

      - uses: slackapi/slack-github-action@v1.26.0
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_WORKFLOW_MONITOR }}
        with:
          # language=json
          payload: |
            {
              "repository": "${{ github.repository }}",
              "workflow": "${{ github.workflow }}",
              "url": "${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"
            }
